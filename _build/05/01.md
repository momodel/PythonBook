---
interact_link: content/D:\ZU_workplace\08_book\Python-book\Pythonbook1\content\05/01.ipynb
kernel_name: python2
has_widgets: false
title: '05-01 十分钟上手 Pandas'
prev_page:
  url: /05/features
  title: '第5章 Pandas'
next_page:
  url: /05/02
  title: '05-02 Series'
comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

# 十分钟上手 Pandas

`pandas` 是一个 `Python Data Analysis Library`。

安装请参考官网的教程，如果安装了 `Anaconda`，则不需要安装 `pandas` 库。

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
%matplotlib inline

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
```
</div>

</div>

## 产生 Pandas 对象

`pandas` 中有三种基本结构：

- `Series`
    - 1D labeled homogeneously-typed array
- `DataFrame`
    - General 2D labeled, size-mutable tabular structure with potentially heterogeneously-typed columns
- `Panel`
    - General 3D labeled, also size-mutable array

### Series

一维 `Series` 可以用一维列表初始化：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
s = pd.Series([1,3,5,np.nan,6,8])

print s
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
0     1
1     3
2     5
3   NaN
4     6
5     8
dtype: float64
```
</div>
</div>
</div>

默认情况下，`Series` 的下标都是数字（可以使用额外参数指定），类型是统一的。

### DataFrame

`DataFrame` 则是个二维结构，这里首先构造一组时间序列，作为我们第一维的下标：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
dates = pd.date_range('20130101', periods=6)

print dates
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
DatetimeIndex(['2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04',
               '2013-01-05', '2013-01-06'],
              dtype='datetime64[ns]', freq='D')
```
</div>
</div>
</div>

然后创建一个 `DataFrame` 结构：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list('ABCD'))

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

默认情况下，如果不指定 `index` 参数和 `columns`，那么他们的值将用从 `0` 开始的数字替代。

除了向 `DataFrame` 中传入二维数组，我们也可以使用字典传入数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df2 = pd.DataFrame({'A' : 1.,
                    'B' : pd.Timestamp('20130102'),
                    'C' : pd.Series(1,index=list(range(4)),dtype='float32'),
                    'D' : np.array([3] * 4,dtype='int32'),
                    'E' : pd.Categorical(["test","train","test","train"]),
                    'F' : 'foo' })

df2
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2013-01-02</td>
      <td>1</td>
      <td>3</td>
      <td>test</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2013-01-02</td>
      <td>1</td>
      <td>3</td>
      <td>train</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2013-01-02</td>
      <td>1</td>
      <td>3</td>
      <td>test</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2013-01-02</td>
      <td>1</td>
      <td>3</td>
      <td>train</td>
      <td>foo</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

字典的每个 `key` 代表一列，其 `value` 可以是各种能够转化为 `Series` 的对象。

与 `Series` 要求所有的类型都一致不同，`DataFrame` 值要求每一列数据的格式相同：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df2.dtypes
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
A           float64
B    datetime64[ns]
C           float32
D             int32
E          category
F            object
dtype: object
```


</div>
</div>
</div>

## 查看数据

### 头尾数据

`head` 和 `tail` 方法可以分别查看最前面几行和最后面几行的数据（默认为 5）：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.head()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

最后 3 行：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.tail(3)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### 下标，列标，数据

下标使用 `index` 属性查看：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.index
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
DatetimeIndex(['2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04',
               '2013-01-05', '2013-01-06'],
              dtype='datetime64[ns]', freq='D')
```


</div>
</div>
</div>

列标使用 `columns` 属性查看：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.columns
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
Index([u'A', u'B', u'C', u'D'], dtype='object')
```


</div>
</div>
</div>

数据值使用 `values` 查看：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.values
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
array([[-0.60593585, -0.86165752, -1.00192387,  1.52858443],
       [-0.16540784,  0.38833783,  1.18718697,  1.81981793],
       [ 0.06525454, -1.60807414, -1.2823306 , -0.28606716],
       [ 1.28930486,  0.49711531, -0.22535143,  0.04023897],
       [ 0.03823179,  0.87505664, -0.0925258 ,  0.93443212],
       [-2.16345271, -0.01027865,  1.69988608,  1.29165337]])
```


</div>
</div>
</div>

### 统计数据

查看简单的统计数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.describe()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.257001</td>
      <td>-0.119917</td>
      <td>0.047490</td>
      <td>0.888110</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.126657</td>
      <td>0.938705</td>
      <td>1.182629</td>
      <td>0.841529</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-2.163453</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.495804</td>
      <td>-0.648813</td>
      <td>-0.807781</td>
      <td>0.263787</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.063588</td>
      <td>0.189030</td>
      <td>-0.158939</td>
      <td>1.113043</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.058499</td>
      <td>0.469921</td>
      <td>0.867259</td>
      <td>1.469352</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.289305</td>
      <td>0.875057</td>
      <td>1.699886</td>
      <td>1.819818</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### 转置

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.T
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2013-01-01 00:00:00</th>
      <th>2013-01-02 00:00:00</th>
      <th>2013-01-03 00:00:00</th>
      <th>2013-01-04 00:00:00</th>
      <th>2013-01-05 00:00:00</th>
      <th>2013-01-06 00:00:00</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>-0.605936</td>
      <td>-0.165408</td>
      <td>0.065255</td>
      <td>1.289305</td>
      <td>0.038232</td>
      <td>-2.163453</td>
    </tr>
    <tr>
      <th>B</th>
      <td>-0.861658</td>
      <td>0.388338</td>
      <td>-1.608074</td>
      <td>0.497115</td>
      <td>0.875057</td>
      <td>-0.010279</td>
    </tr>
    <tr>
      <th>C</th>
      <td>-1.001924</td>
      <td>1.187187</td>
      <td>-1.282331</td>
      <td>-0.225351</td>
      <td>-0.092526</td>
      <td>1.699886</td>
    </tr>
    <tr>
      <th>D</th>
      <td>1.528584</td>
      <td>1.819818</td>
      <td>-0.286067</td>
      <td>0.040239</td>
      <td>0.934432</td>
      <td>1.291653</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

## 排序

`sort_index(axis=0, ascending=True)` 方法按照下标大小进行排序，`axis=0` 表示按第 0 维进行排序。

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.sort_index(ascending=False)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.sort_index(axis=1, ascending=False)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>D</th>
      <th>C</th>
      <th>B</th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>1.528584</td>
      <td>-1.001924</td>
      <td>-0.861658</td>
      <td>-0.605936</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>1.819818</td>
      <td>1.187187</td>
      <td>0.388338</td>
      <td>-0.165408</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>-0.286067</td>
      <td>-1.282331</td>
      <td>-1.608074</td>
      <td>0.065255</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>0.040239</td>
      <td>-0.225351</td>
      <td>0.497115</td>
      <td>1.289305</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.934432</td>
      <td>-0.092526</td>
      <td>0.875057</td>
      <td>0.038232</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>1.291653</td>
      <td>1.699886</td>
      <td>-0.010279</td>
      <td>-2.163453</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

`sort_values(by, axis=0, ascending=True)` 方法按照 `by` 的值的大小进行排序，例如按照 `B` 列的大小：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.sort_values(by="B")
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

## 索引

虽然 `DataFrame` 支持 `Python/Numpy` 的索引语法，但是推荐使用 `.at, .iat, .loc, .iloc 和 .ix` 方法进行索引。

### 读取数据

选择单列数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df["A"]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2013-01-01   -0.605936
2013-01-02   -0.165408
2013-01-03    0.065255
2013-01-04    1.289305
2013-01-05    0.038232
2013-01-06   -2.163453
Freq: D, Name: A, dtype: float64
```


</div>
</div>
</div>

也可以用 `df.A`：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.A
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2013-01-01   -0.605936
2013-01-02   -0.165408
2013-01-03    0.065255
2013-01-04    1.289305
2013-01-05    0.038232
2013-01-06   -2.163453
Freq: D, Name: A, dtype: float64
```


</div>
</div>
</div>

使用切片读取多行：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df[0:3]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

`index` 名字也可以进行切片：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df["20130101":"20130103"]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### 使用 `label` 索引

`loc` 可以方便的使用 `label` 进行索引：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.loc[dates[0]]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
A   -0.605936
B   -0.861658
C   -1.001924
D    1.528584
Name: 2013-01-01 00:00:00, dtype: float64
```


</div>
</div>
</div>

多列数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.loc[:,['A','B']]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

选择多行多列：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.loc['20130102':'20130104',['A','B']]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

数据降维：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.loc['20130102',['A','B']]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
A   -0.165408
B    0.388338
Name: 2013-01-02 00:00:00, dtype: float64
```


</div>
</div>
</div>

得到标量值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.loc[dates[0],'B']
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
-0.86165751902832299
```


</div>
</div>
</div>

不过得到标量值可以用 `at`，速度更快：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
%timeit -n100 df.loc[dates[0],'B']
%timeit -n100 df.at[dates[0],'B']

print df.at[dates[0],'B']
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
100 loops, best of 3: 329 µs per loop
100 loops, best of 3: 31.1 µs per loop
-0.861657519028
```
</div>
</div>
</div>

### 使用位置索引

`iloc` 使用位置进行索引：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iloc[3]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
A    1.289305
B    0.497115
C   -0.225351
D    0.040239
Name: 2013-01-04 00:00:00, dtype: float64
```


</div>
</div>
</div>

连续切片：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iloc[3:5,0:2]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

索引不连续的部分：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iloc[[1,2,4],[0,2]]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>1.187187</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.282331</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>-0.092526</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

索引整行：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iloc[1:3,:]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

整列：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iloc[:, 1:3]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.861658</td>
      <td>-1.001924</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>0.388338</td>
      <td>1.187187</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>-1.608074</td>
      <td>-1.282331</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>0.497115</td>
      <td>-0.225351</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.875057</td>
      <td>-0.092526</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-0.010279</td>
      <td>1.699886</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

标量值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iloc[1,1]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
0.3883378290420279
```


</div>
</div>
</div>

当然，使用 `iat` 索引标量值更快：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
%timeit -n100 df.iloc[1,1]
%timeit -n100 df.iat[1,1]

df.iat[1,1]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
100 loops, best of 3: 236 µs per loop
100 loops, best of 3: 14.5 µs per loop
```
</div>
</div>
<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
0.3883378290420279
```


</div>
</div>
</div>

### 布尔型索引

所有 `A` 列大于 0 的行：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df[df.A > 0]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

只留下所有大于 0 的数值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df[df > 0]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.528584</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>NaN</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>NaN</td>
      <td>0.040239</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>NaN</td>
      <td>0.934432</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.699886</td>
      <td>1.291653</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

使用 `isin` 方法做 `filter` 过滤：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df2 = df.copy()
df2['E'] = ['one', 'one','two','three','four','three']

df2
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
      <td>one</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
      <td>one</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
      <td>two</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
      <td>three</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
      <td>four</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
      <td>three</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df2[df2['E'].isin(['two','four'])]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
      <td>two</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
      <td>four</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### 设定数据的值

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
s1 = pd.Series([1,2,3,4,5,6], index=pd.date_range('20130102', periods=6))

s1
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2013-01-02    1
2013-01-03    2
2013-01-04    3
2013-01-05    4
2013-01-06    5
2013-01-07    6
Freq: D, dtype: int64
```


</div>
</div>
</div>

像字典一样，直接指定 `F` 列的值为 `s1`，此时以 `df` 已有的 `index` 为标准将二者进行合并，`s1` 中没有的 `index` 项设为 `NaN`，多余的项舍去：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df['F'] = s1

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>-0.605936</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

或者使用 `at` 或 `iat` 修改单个值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.at[dates[0],'A'] = 0

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>-0.861658</td>
      <td>-1.001924</td>
      <td>1.528584</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.iat[0, 1] = 0

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.001924</td>
      <td>1.528584</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>1.819818</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-0.286067</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>0.040239</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>0.934432</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>1.291653</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

设定一整列：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.loc[:,'D'] = np.array([5] * len(df))

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.001924</td>
      <td>5</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.038232</td>
      <td>0.875057</td>
      <td>-0.092526</td>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>1.699886</td>
      <td>5</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

设定满足条件的数值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df2 = df.copy()

df2[df2 > 0] = -df2

df2
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.001924</td>
      <td>-5</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>-0.388338</td>
      <td>-1.187187</td>
      <td>-5</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>-0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>-5</td>
      <td>-2</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>-1.289305</td>
      <td>-0.497115</td>
      <td>-0.225351</td>
      <td>-5</td>
      <td>-3</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>-0.038232</td>
      <td>-0.875057</td>
      <td>-0.092526</td>
      <td>-5</td>
      <td>-4</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-2.163453</td>
      <td>-0.010279</td>
      <td>-1.699886</td>
      <td>-5</td>
      <td>-5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

## 缺失数据

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df1 = df.reindex(index=dates[0:4], columns=list(df.columns) + ['E'])
df1.loc[dates[0]:dates[1],'E'] = 1

df1
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.001924</td>
      <td>5</td>
      <td>NaN</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>5</td>
      <td>2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>5</td>
      <td>3</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

丢弃所有缺失数据的行得到的新数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df1.dropna(how='any')
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

填充缺失数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df1.fillna(value=5)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.001924</td>
      <td>5</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>1.187187</td>
      <td>5</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.065255</td>
      <td>-1.608074</td>
      <td>-1.282331</td>
      <td>5</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.289305</td>
      <td>0.497115</td>
      <td>-0.225351</td>
      <td>5</td>
      <td>3</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

检查缺失数据的位置：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
pd.isnull(df1)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

## 计算操作

### 统计信息

每一列的均值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.mean()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
A   -0.156012
B    0.023693
C    0.047490
D    5.000000
F    3.000000
dtype: float64
```


</div>
</div>
</div>

每一行的均值：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.mean(1)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2013-01-01    0.999519
2013-01-02    1.482023
2013-01-03    0.834970
2013-01-04    1.912214
2013-01-05    1.964153
2013-01-06    1.905231
Freq: D, dtype: float64
```


</div>
</div>
</div>

多个对象之间的操作，如果维度不对，`pandas` 会自动调用 `broadcasting` 机制：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
s = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)

print s
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
2013-01-01   NaN
2013-01-02   NaN
2013-01-03     1
2013-01-04     3
2013-01-05     5
2013-01-06   NaN
Freq: D, dtype: float64
```
</div>
</div>
</div>

相减 `df - s`：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.sub(s, axis='index')
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>-0.934745</td>
      <td>-2.608074</td>
      <td>-2.282331</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>-1.710695</td>
      <td>-2.502885</td>
      <td>-3.225351</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>-4.961768</td>
      <td>-4.124943</td>
      <td>-5.092526</td>
      <td>0</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### apply 操作

与 `R` 中的 `apply` 操作类似，接收一个函数，默认是对将函数作用到每一列上：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.apply(np.cumsum)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-1.001924</td>
      <td>5</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>-0.165408</td>
      <td>0.388338</td>
      <td>0.185263</td>
      <td>10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>-0.100153</td>
      <td>-1.219736</td>
      <td>-1.097067</td>
      <td>15</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>1.189152</td>
      <td>-0.722621</td>
      <td>-1.322419</td>
      <td>20</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>1.227383</td>
      <td>0.152436</td>
      <td>-1.414945</td>
      <td>25</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2013-01-06</th>
      <td>-0.936069</td>
      <td>0.142157</td>
      <td>0.284941</td>
      <td>30</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

求每列最大最小值之差：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.apply(lambda x: x.max() - x.min())
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
A    3.452758
B    2.483131
C    2.982217
D    0.000000
F    4.000000
dtype: float64
```


</div>
</div>
</div>

### 直方图

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
s = pd.Series(np.random.randint(0, 7, size=10))
print s
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
0    2
1    5
2    6
3    6
4    6
5    3
6    5
7    0
8    4
9    4
dtype: int64
```
</div>
</div>
</div>

直方图信息：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
print s.value_counts()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
6    3
5    2
4    2
3    1
2    1
0    1
dtype: int64
```
</div>
</div>
</div>

绘制直方图信息：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
h = s.hist()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">

{:.output_png}
![png](D%3A/ZU_workplace/08_book/Python-book/Pythonbook1/_build/images/05/01_126_0.png)

</div>
</div>
</div>

### 字符串方法

当 `Series` 或者 `DataFrame` 的某一列是字符串时，我们可以用 `.str` 对这个字符串数组进行字符串的基本操作： 

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
s = pd.Series(['A', 'B', 'C', 'Aaba', 'Baca', np.nan, 'CABA', 'dog', 'cat'])

print s.str.lower()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
0       a
1       b
2       c
3    aaba
4    baca
5     NaN
6    caba
7     dog
8     cat
dtype: object
```
</div>
</div>
</div>

## 合并

### 连接

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df = pd.DataFrame(np.random.randn(10, 4))

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-2.346373</td>
      <td>0.105651</td>
      <td>-0.048027</td>
      <td>0.010637</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.682198</td>
      <td>0.943043</td>
      <td>0.147312</td>
      <td>-0.657871</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.515766</td>
      <td>-0.768286</td>
      <td>0.361570</td>
      <td>1.146278</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.607277</td>
      <td>-0.003086</td>
      <td>-1.499001</td>
      <td>1.165728</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.226279</td>
      <td>-0.177246</td>
      <td>-1.379631</td>
      <td>-0.639261</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.807364</td>
      <td>-1.855060</td>
      <td>0.325968</td>
      <td>1.898831</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.438539</td>
      <td>-0.728131</td>
      <td>-0.009924</td>
      <td>0.398360</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.497457</td>
      <td>-1.506314</td>
      <td>-1.557624</td>
      <td>0.869043</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.945985</td>
      <td>-0.519435</td>
      <td>-0.510359</td>
      <td>-1.077751</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.597679</td>
      <td>-0.285955</td>
      <td>-1.060736</td>
      <td>0.608629</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

可以使用 `pd.concat` 函数将多个 `pandas` 对象进行连接：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
pieces = [df[:2], df[4:5], df[7:]]

pd.concat(pieces)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-2.346373</td>
      <td>0.105651</td>
      <td>-0.048027</td>
      <td>0.010637</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.682198</td>
      <td>0.943043</td>
      <td>0.147312</td>
      <td>-0.657871</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.226279</td>
      <td>-0.177246</td>
      <td>-1.379631</td>
      <td>-0.639261</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.497457</td>
      <td>-1.506314</td>
      <td>-1.557624</td>
      <td>0.869043</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.945985</td>
      <td>-0.519435</td>
      <td>-0.510359</td>
      <td>-1.077751</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.597679</td>
      <td>-0.285955</td>
      <td>-1.060736</td>
      <td>0.608629</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### 数据库中的 Join

`merge` 可以实现数据库中的 `join` 操作：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
left = pd.DataFrame({'key': ['foo', 'foo'], 'lval': [1, 2]})
right = pd.DataFrame({'key': ['foo', 'foo'], 'rval': [4, 5]})

print left
print right
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">
{:.output_stream}
```
   key  lval
0  foo     1
1  foo     2
   key  rval
0  foo     4
1  foo     5
```
</div>
</div>
</div>

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
pd.merge(left, right, on='key')
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>lval</th>
      <th>rval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>foo</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>foo</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>foo</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>foo</td>
      <td>2</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### append

向 `DataFrame` 中添加行：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df = pd.DataFrame(np.random.randn(8, 4), columns=['A','B','C','D'])

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.587778</td>
      <td>-0.110297</td>
      <td>0.602245</td>
      <td>1.212597</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.551109</td>
      <td>0.337387</td>
      <td>-0.220919</td>
      <td>0.363332</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.207373</td>
      <td>-0.128394</td>
      <td>0.619937</td>
      <td>-0.612694</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.978282</td>
      <td>-1.038170</td>
      <td>0.048995</td>
      <td>-0.788973</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.843893</td>
      <td>-1.079021</td>
      <td>0.092212</td>
      <td>0.485422</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.056594</td>
      <td>1.831206</td>
      <td>1.910864</td>
      <td>-1.331739</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.487106</td>
      <td>-1.495367</td>
      <td>0.853440</td>
      <td>0.410854</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.830852</td>
      <td>-0.014893</td>
      <td>0.254025</td>
      <td>0.197422</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

将第三行的值添加到最后：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
s = df.iloc[3]

df.append(s, ignore_index=True)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.587778</td>
      <td>-0.110297</td>
      <td>0.602245</td>
      <td>1.212597</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.551109</td>
      <td>0.337387</td>
      <td>-0.220919</td>
      <td>0.363332</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.207373</td>
      <td>-0.128394</td>
      <td>0.619937</td>
      <td>-0.612694</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.978282</td>
      <td>-1.038170</td>
      <td>0.048995</td>
      <td>-0.788973</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.843893</td>
      <td>-1.079021</td>
      <td>0.092212</td>
      <td>0.485422</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.056594</td>
      <td>1.831206</td>
      <td>1.910864</td>
      <td>-1.331739</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.487106</td>
      <td>-1.495367</td>
      <td>0.853440</td>
      <td>0.410854</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.830852</td>
      <td>-0.014893</td>
      <td>0.254025</td>
      <td>0.197422</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.978282</td>
      <td>-1.038170</td>
      <td>0.048995</td>
      <td>-0.788973</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### Grouping

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df = pd.DataFrame({'A' : ['foo', 'bar', 'foo', 'bar',
                          'foo', 'bar', 'foo', 'foo'],
                   'B' : ['one', 'one', 'two', 'three',
                          'two', 'two', 'one', 'three'],
                   'C' : np.random.randn(8),
                   'D' : np.random.randn(8)})

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>foo</td>
      <td>one</td>
      <td>0.773062</td>
      <td>0.206503</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bar</td>
      <td>one</td>
      <td>1.414609</td>
      <td>-0.346719</td>
    </tr>
    <tr>
      <th>2</th>
      <td>foo</td>
      <td>two</td>
      <td>0.964174</td>
      <td>0.706623</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bar</td>
      <td>three</td>
      <td>0.182239</td>
      <td>-1.516509</td>
    </tr>
    <tr>
      <th>4</th>
      <td>foo</td>
      <td>two</td>
      <td>-0.096255</td>
      <td>0.494177</td>
    </tr>
    <tr>
      <th>5</th>
      <td>bar</td>
      <td>two</td>
      <td>-0.759471</td>
      <td>-0.389213</td>
    </tr>
    <tr>
      <th>6</th>
      <td>foo</td>
      <td>one</td>
      <td>-0.257519</td>
      <td>-1.411693</td>
    </tr>
    <tr>
      <th>7</th>
      <td>foo</td>
      <td>three</td>
      <td>-0.109368</td>
      <td>0.241862</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

按照 `A` 的值进行分类：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.groupby('A').sum()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>A</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bar</th>
      <td>0.837377</td>
      <td>-2.252441</td>
    </tr>
    <tr>
      <th>foo</th>
      <td>1.274094</td>
      <td>0.237472</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

按照 `A, B` 的值进行分类：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.groupby(['A', 'B']).sum()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>A</th>
      <th>B</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">bar</th>
      <th>one</th>
      <td>1.414609</td>
      <td>-0.346719</td>
    </tr>
    <tr>
      <th>three</th>
      <td>0.182239</td>
      <td>-1.516509</td>
    </tr>
    <tr>
      <th>two</th>
      <td>-0.759471</td>
      <td>-0.389213</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">foo</th>
      <th>one</th>
      <td>0.515543</td>
      <td>-1.205191</td>
    </tr>
    <tr>
      <th>three</th>
      <td>-0.109368</td>
      <td>0.241862</td>
    </tr>
    <tr>
      <th>two</th>
      <td>0.867919</td>
      <td>1.200800</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

## 改变形状

### Stack

产生一个多 `index` 的 `DataFrame`：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
tuples = list(zip(*[['bar', 'bar', 'baz', 'baz',
                     'foo', 'foo', 'qux', 'qux'],
                    ['one', 'two', 'one', 'two',
                     'one', 'two', 'one', 'two']]))

index = pd.MultiIndex.from_tuples(tuples, names=['first', 'second'])
df = pd.DataFrame(np.random.randn(8, 2), index=index, columns=['A', 'B'])

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>first</th>
      <th>second</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">bar</th>
      <th>one</th>
      <td>-0.109174</td>
      <td>0.958551</td>
    </tr>
    <tr>
      <th>two</th>
      <td>-0.254743</td>
      <td>-0.975924</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">baz</th>
      <th>one</th>
      <td>-0.132039</td>
      <td>-0.119009</td>
    </tr>
    <tr>
      <th>two</th>
      <td>0.587063</td>
      <td>-0.819037</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">foo</th>
      <th>one</th>
      <td>-0.754123</td>
      <td>0.430747</td>
    </tr>
    <tr>
      <th>two</th>
      <td>-0.426544</td>
      <td>0.389822</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">qux</th>
      <th>one</th>
      <td>-0.382501</td>
      <td>-0.562910</td>
    </tr>
    <tr>
      <th>two</th>
      <td>-0.529287</td>
      <td>0.826337</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

`stack` 方法将 `columns` 变成一个新的 `index` 部分：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df2 = df[:4]

stacked = df2.stack()

stacked
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
first  second   
bar    one     A   -0.109174
               B    0.958551
       two     A   -0.254743
               B   -0.975924
baz    one     A   -0.132039
               B   -0.119009
       two     A    0.587063
               B   -0.819037
dtype: float64
```


</div>
</div>
</div>

可以使用 `unstack()` 将最后一级 `index` 放回 `column`：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
stacked.unstack()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>first</th>
      <th>second</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">bar</th>
      <th>one</th>
      <td>-0.109174</td>
      <td>0.958551</td>
    </tr>
    <tr>
      <th>two</th>
      <td>-0.254743</td>
      <td>-0.975924</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">baz</th>
      <th>one</th>
      <td>-0.132039</td>
      <td>-0.119009</td>
    </tr>
    <tr>
      <th>two</th>
      <td>0.587063</td>
      <td>-0.819037</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

也可以指定其他的级别：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
stacked.unstack(1)
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>second</th>
      <th>one</th>
      <th>two</th>
    </tr>
    <tr>
      <th>first</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">bar</th>
      <th>A</th>
      <td>-0.109174</td>
      <td>-0.254743</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.958551</td>
      <td>-0.975924</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">baz</th>
      <th>A</th>
      <td>-0.132039</td>
      <td>0.587063</td>
    </tr>
    <tr>
      <th>B</th>
      <td>-0.119009</td>
      <td>-0.819037</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

## 时间序列

金融分析中常用到时间序列数据：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
rng = pd.date_range('3/6/2012 00:00', periods=5, freq='D')
ts = pd.Series(np.random.randn(len(rng)), rng)

ts
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2012-03-06    1.096788
2012-03-07    0.029678
2012-03-08    0.511461
2012-03-09   -0.332369
2012-03-10    1.720321
Freq: D, dtype: float64
```


</div>
</div>
</div>

标准时间表示：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
ts_utc = ts.tz_localize('UTC')

ts_utc
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2012-03-06 00:00:00+00:00    1.096788
2012-03-07 00:00:00+00:00    0.029678
2012-03-08 00:00:00+00:00    0.511461
2012-03-09 00:00:00+00:00   -0.332369
2012-03-10 00:00:00+00:00    1.720321
Freq: D, dtype: float64
```


</div>
</div>
</div>

改变时区表示：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
ts_utc.tz_convert('US/Eastern')
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
2012-03-05 19:00:00-05:00    1.096788
2012-03-06 19:00:00-05:00    0.029678
2012-03-07 19:00:00-05:00    0.511461
2012-03-08 19:00:00-05:00   -0.332369
2012-03-09 19:00:00-05:00    1.720321
Freq: D, dtype: float64
```


</div>
</div>
</div>

## Categoricals

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df = pd.DataFrame({"id":[1,2,3,4,5,6], "raw_grade":['a', 'b', 'b', 'a', 'a', 'e']})

df
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>raw_grade</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>a</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>b</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>a</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>a</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>e</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

可以将 `grade` 变成类别：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df["grade"] = df["raw_grade"].astype("category")

df["grade"]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
0    a
1    b
2    b
3    a
4    a
5    e
Name: grade, dtype: category
Categories (3, object): [a, b, e]
```


</div>
</div>
</div>

将类别的表示转化为有意义的字符：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df["grade"].cat.categories = ["very good", "good", "very bad"]

df["grade"]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
0    very good
1         good
2         good
3    very good
4    very good
5     very bad
Name: grade, dtype: category
Categories (3, object): [very good, good, very bad]
```


</div>
</div>
</div>

添加缺失的类别：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df["grade"] = df["grade"].cat.set_categories(["very bad", "bad", "medium", "good", "very good"])
df["grade"]
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
0    very good
1         good
2         good
3    very good
4    very good
5     very bad
Name: grade, dtype: category
Categories (5, object): [very bad, bad, medium, good, very good]
```


</div>
</div>
</div>

使用 `grade` 分组：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.groupby("grade").size()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">


{:.output_data_text}
```
grade
very bad     1
bad          0
medium       0
good         2
very good    3
dtype: int64
```


</div>
</div>
</div>

## 绘图

使用 `ggplot` 风格：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
plt.style.use('ggplot')
```
</div>

</div>

`Series` 绘图：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
ts = pd.Series(np.random.randn(1000), index=pd.date_range('1/1/2000', periods=1000))

p = ts.cumsum().plot()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">

{:.output_png}
![png](D%3A/ZU_workplace/08_book/Python-book/Pythonbook1/_build/images/05/01_181_0.png)

</div>
</div>
</div>

`DataFrame` 按照 `columns` 绘图：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df = pd.DataFrame(np.random.randn(1000, 4), index=ts.index,
                  columns=['A', 'B', 'C', 'D'])

df.cumsum().plot()
p = plt.legend(loc="best")
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">

{:.output_png}
![png](D%3A/ZU_workplace/08_book/Python-book/Pythonbook1/_build/images/05/01_183_0.png)

</div>
</div>
</div>

## 文件读写

### csv

写入文件：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.to_csv('foo.csv')
```
</div>

</div>

从文件中读取：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
pd.read_csv('foo.csv').head()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-01-01</td>
      <td>-1.011554</td>
      <td>1.200283</td>
      <td>-0.310949</td>
      <td>-1.060734</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-01-02</td>
      <td>-1.030894</td>
      <td>0.660518</td>
      <td>-0.214002</td>
      <td>-0.422014</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-01-03</td>
      <td>-0.488692</td>
      <td>1.709209</td>
      <td>-0.602208</td>
      <td>1.115456</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-01-04</td>
      <td>-0.440243</td>
      <td>0.826692</td>
      <td>0.321648</td>
      <td>-0.351698</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-01-05</td>
      <td>-0.165684</td>
      <td>1.297303</td>
      <td>0.817233</td>
      <td>0.174767</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### hdf5

写入文件：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.to_hdf("foo.h5", "df")
```
</div>

</div>

读取文件：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
pd.read_hdf('foo.h5','df').head()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>-1.011554</td>
      <td>1.200283</td>
      <td>-0.310949</td>
      <td>-1.060734</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>-1.030894</td>
      <td>0.660518</td>
      <td>-0.214002</td>
      <td>-0.422014</td>
    </tr>
    <tr>
      <th>2000-01-03</th>
      <td>-0.488692</td>
      <td>1.709209</td>
      <td>-0.602208</td>
      <td>1.115456</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>-0.440243</td>
      <td>0.826692</td>
      <td>0.321648</td>
      <td>-0.351698</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>-0.165684</td>
      <td>1.297303</td>
      <td>0.817233</td>
      <td>0.174767</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

### excel

写入文件：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
df.to_excel('foo.xlsx', sheet_name='Sheet1')
```
</div>

</div>

读取文件：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
pd.read_excel('foo.xlsx', 'Sheet1', index_col=None, na_values=['NA']).head()
```
</div>

<div class="output_wrapper" markdown="1">
<div class="output_subarea" markdown="1">



<div markdown="0" class="output output_html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>-1.011554</td>
      <td>1.200283</td>
      <td>-0.310949</td>
      <td>-1.060734</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>-1.030894</td>
      <td>0.660518</td>
      <td>-0.214002</td>
      <td>-0.422014</td>
    </tr>
    <tr>
      <th>2000-01-03</th>
      <td>-0.488692</td>
      <td>1.709209</td>
      <td>-0.602208</td>
      <td>1.115456</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>-0.440243</td>
      <td>0.826692</td>
      <td>0.321648</td>
      <td>-0.351698</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>-0.165684</td>
      <td>1.297303</td>
      <td>0.817233</td>
      <td>0.174767</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</div>
</div>
</div>

清理生成的临时文件：

<div markdown="1" class="cell code_cell">
<div class="input_area" markdown="1">
```python
import glob
import os

for f in glob.glob("foo*"):
    os.remove(f)
```
</div>

</div>
